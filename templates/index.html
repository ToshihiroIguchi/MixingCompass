<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ app_name }}</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="stylesheet" href="/static/css/styles.css?v=2024092906">
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <img src="/static/images/mc_logo.png" alt="MixingCompass Logo" class="logo">
                <h1>{{ app_name }}</h1>
            </div>
            <nav class="navigation">
                <button class="nav-btn active" data-section="hsp-experimental">HSP (Experimental)</button>
                <button class="nav-btn" data-section="hsp-calculation">HSP (Calculation)</button>
                <button class="nav-btn" data-section="solvent-search">Solvent Search</button>
                <button class="nav-btn" data-section="data-list">Data List</button>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <!-- HSP Experimental Section -->
        <section id="hsp-experimental" class="content-section active">
            <div class="split-layout">
                <div class="left-panel">
                    <div class="panel-header">
                        <h2>HSP Experimental Data</h2>
                        <button id="load-data-btn" class="btn btn-secondary">Load Data</button>
                    </div>
                    <div class="sample-info">
                        <label>Sample Name:</label>
                        <input type="text" id="sample-name" placeholder="Enter sample name" required>
                    </div>
                    <div id="solvent-table-container" class="data-table-container">
                        <!-- Solvent table will be dynamically generated -->
                    </div>
                    <div class="calculation-section">
                        <button id="calculate-btn" class="btn btn-primary">Analyze & Visualize</button>
                        <div class="calculation-status" id="calculation-status"></div>
                    </div>
                </div>
                <div class="right-panel">
                    <div class="results-section">
                        <div class="results-header">
                            <h3>HSP</h3>
                            <div class="hsp-values-inline">
                                <span class="hsp-value-inline">
                                    <label>&delta;D:</label>
                                    <span id="delta-d" class="value">-</span>
                                    <span class="unit">MPa<sup>0.5</sup></span>
                                </span>
                                <span class="hsp-value-inline">
                                    <label>&delta;P:</label>
                                    <span id="delta-p" class="value">-</span>
                                    <span class="unit">MPa<sup>0.5</sup></span>
                                </span>
                                <span class="hsp-value-inline">
                                    <label>&delta;H:</label>
                                    <span id="delta-h" class="value">-</span>
                                    <span class="unit">MPa<sup>0.5</sup></span>
                                </span>
                                <span class="hsp-value-inline">
                                    <label>Ra:</label>
                                    <span id="ra" class="value">-</span>
                                    <span class="unit">MPa<sup>0.5</sup></span>
                                </span>
                            </div>
                            <div class="result-actions">
                                <button id="details-info-btn" class="info-btn" title="View calculation details" style="display: none;">â“˜</button>
                                <button id="copy-hsp-btn" class="info-btn" title="Copy HSP data for Excel" style="display: none;">ðŸ“‹</button>
                            </div>
                        </div>
                    </div>
                    <div class="hansen-sphere" id="hansen-sphere-container">
                        <div class="viz-tabs">
                            <button class="viz-tab active" data-view="view-3d">3D View</button>
                            <button class="viz-tab" data-view="view-2d">2D Projections</button>
                        </div>
                        <div id="view-3d" class="view-panel active">
                            <div id="plotly-visualization" class="plotly-container">
                                <div class="visualization-placeholder">
                                    <p>Calculate HSP to display 3D Hansen sphere</p>
                                    <small>Interactive 3D visualization will appear after calculation</small>
                                </div>
                            </div>
                        </div>
                        <div id="view-2d" class="view-panel" style="display: none;">
                            <div class="grid-2d">
                                <div class="plot-item">
                                    <div id="plot-dd-dp" class="plot-2d"></div>
                                </div>
                                <div class="plot-item">
                                    <div id="plot-dd-dh" class="plot-2d"></div>
                                </div>
                                <div class="plot-item">
                                    <div id="plot-dp-dh" class="plot-2d"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button id="save-result-btn" class="btn btn-primary" disabled>Save Result</button>
                        <button id="export-package-btn" class="btn btn-secondary" disabled>Export Package (ZIP)</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Calculation Details Modal -->
        <div id="calculation-details-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h4>Calculation Details</h4>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body" id="modal-calculation-details">
                    <!-- Details will be populated here -->
                </div>
            </div>
        </div>

        <!-- Load Data Modal -->
        <div id="load-data-modal" class="modal" style="display: none;">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h3>Load Experimental Result</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="search-section">
                        <input type="text" id="result-search" class="search-input" placeholder="Search by sample name...">
                    </div>
                    <div id="results-list" class="results-list">
                        <!-- Results will be populated here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="cancel-load-data" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- HSP Calculation Section -->
        <section id="hsp-calculation" class="content-section">
            <h2>HSP Calculation</h2>
            <p>SMILES-based calculation functionality (To be implemented)</p>
        </section>

        <!-- Solvent Search Section -->
        <section id="solvent-search" class="content-section">
            <div class="solvent-search-container">
                <div class="search-panels">
                    <!-- Left Panel: Search Input -->
                    <div class="search-input-panel">
                        <h2>Solvent Search</h2>

                        <!-- Target HSP Input -->
                        <div class="search-section">
                            <h3>Target HSP Values</h3>
                            <div class="hsp-input-grid">
                                <div class="input-group">
                                    <label for="target-delta-d">Î´D (MPa<sup>0.5</sup>)</label>
                                    <input type="number" id="target-delta-d" step="0.1" placeholder="15.5">
                                </div>
                                <div class="input-group">
                                    <label for="target-delta-p">Î´P (MPa<sup>0.5</sup>)</label>
                                    <input type="number" id="target-delta-p" step="0.1" placeholder="7.0">
                                </div>
                                <div class="input-group">
                                    <label for="target-delta-h">Î´H (MPa<sup>0.5</sup>)</label>
                                    <input type="number" id="target-delta-h" step="0.1" placeholder="8.0">
                                </div>
                            </div>
                            <div class="input-group">
                                <label for="target-radius">Search Radius Ra (MPa<sup>0.5</sup>)</label>
                                <input type="number" id="target-radius" step="0.1" placeholder="5.0" value="5.0">
                                <small>Leave empty for unlimited distance</small>
                            </div>
                        </div>

                        <!-- Filters -->
                        <div class="search-section">
                            <h3>Filters <button id="toggle-filters" class="btn-small btn-secondary">Show/Hide</button></h3>
                            <div id="filter-options" style="display: none;">
                                <div class="filter-group">
                                    <label>Boiling Point (Â°C)</label>
                                    <div class="range-inputs">
                                        <input type="number" id="bp-min" placeholder="Min">
                                        <span>â€”</span>
                                        <input type="number" id="bp-max" placeholder="Max">
                                    </div>
                                </div>
                                <div class="filter-group">
                                    <label>Cost (USD/mL)</label>
                                    <div class="range-inputs">
                                        <input type="number" id="cost-min" placeholder="Min" step="0.01">
                                        <span>â€”</span>
                                        <input type="number" id="cost-max" placeholder="Max" step="0.01">
                                    </div>
                                </div>
                                <div class="filter-group">
                                    <label>Safety (WGK)</label>
                                    <select id="wgk-filter" multiple size="4">
                                        <option value="all" selected>All</option>
                                        <option value="1">WGK 1 (Low hazard)</option>
                                        <option value="2">WGK 2 (Moderate hazard)</option>
                                        <option value="3">WGK 3 (High hazard)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Search Mode -->
                        <div class="search-section">
                            <h3>Search Mode</h3>
                            <div class="mode-selector">
                                <label>
                                    <input type="radio" name="search-mode" value="single" checked>
                                    Single Solvent
                                </label>
                                <label>
                                    <input type="radio" name="search-mode" value="blend">
                                    2-Component Blend
                                </label>
                            </div>
                        </div>

                        <!-- Search Button -->
                        <button id="search-solvents-btn" class="btn btn-primary" disabled>Search Solvents</button>
                    </div>

                    <!-- Right Panel: Results -->
                    <div class="search-results-panel">
                        <div class="results-header">
                            <h3>Search Results</h3>
                            <div class="results-controls">
                                <span id="results-count-display">0 results</span>
                                <select id="sort-results">
                                    <option value="distance">Sort by: Distance (RED)</option>
                                    <option value="name">Sort by: Name</option>
                                    <option value="bp">Sort by: Boiling Point</option>
                                    <option value="cost">Sort by: Cost</option>
                                </select>
                            </div>
                        </div>

                        <div id="search-results-list" class="search-results-list">
                            <div class="empty-state">
                                <p>Enter target HSP values and click "Search Solvents" to find suitable solvents.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Visualization Section (Optional) -->
                <div class="search-visualization-section" style="display: none;">
                    <h3>2D Visualization</h3>
                    <div id="search-viz-container" class="search-viz-grid">
                        <div id="search-plot-dd-dp"></div>
                        <div id="search-plot-dd-dh"></div>
                        <div id="search-plot-dp-dh"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Data List Section -->
        <section id="data-list" class="content-section">
            <div class="data-list-container">
                <div class="data-list-header">
                    <h2>Solvent Set Management</h2>
                    <div class="header-actions">
                        <button id="import-sets-btn" class="btn btn-secondary">Import Sets</button>
                        <button id="export-sets-btn" class="btn btn-secondary">Export Sets</button>
                    </div>
                </div>

                <!-- Experimental Results Section -->
                <div class="experimental-results-section">
                    <div class="section-header">
                        <h3>Experimental Results</h3>
                        <span id="results-count" class="count-badge">0 results</span>
                    </div>

                    <div id="experimental-results-list" class="experimental-results-list">
                        <div class="empty-state">
                            <p>No experimental results saved yet.</p>
                            <p>Run HSP calculations and save results to manage them here.</p>
                        </div>
                    </div>
                </div>

                <div class="solvent-sets-section">
                    <div class="section-header">
                        <h3>Saved Solvent Sets</h3>
                        <span id="sets-count" class="count-badge">0 sets</span>
                    </div>

                    <div id="solvent-sets-list" class="solvent-sets-list">
                        <div class="empty-state">
                            <p>No solvent sets saved yet.</p>
                            <p>Create sets in the HSP (Experimental) tab to manage them here.</p>
                        </div>
                    </div>
                </div>

                <!-- Edit Modal -->
                <div id="edit-set-modal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Edit Solvent Set</h3>
                            <button class="modal-close">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="edit-set-name">Set Name:</label>
                                <input type="text" id="edit-set-name" class="form-input" placeholder="Enter set name">
                            </div>

                            <div class="form-group">
                                <label>Solvents in this set:</label>
                                <div id="edit-solvents-list" class="edit-solvents-list">
                                    <!-- Solvent list will be populated dynamically -->
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button id="save-set-changes" class="btn btn-primary">Save Changes</button>
                            <button id="cancel-set-edit" class="btn btn-secondary">Cancel</button>
                        </div>
                    </div>
                </div>

                <!-- Import File Input -->
                <input type="file" id="import-file-input" accept=".json" style="display: none;">
            </div>
        </section>
    </main>

    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <script src="/static/js/utils.js"></script>
    <script src="/static/js/notification.js"></script>
    <script src="/static/js/storage.js"></script>
    <script src="/static/js/main.js"></script>
    <script src="/static/js/solvent_set_manager.js"></script>
    <script src="/static/js/experimental_results_manager.js"></script>
    <script src="/static/js/hsp_experimental.js"></script>
    <script src="/static/js/solvent_search.js"></script>
    <script src="/static/js/data_list.js"></script>
</body>
</html>