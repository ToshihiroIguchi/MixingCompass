<!DOCTYPE html>
<html>
<head>
    <title>HSP Values Debug</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-info { background: #f0f0f0; padding: 15px; margin: 10px 0; font-family: monospace; }
        .test-container { margin-bottom: 30px; border: 1px solid #ccc; padding: 20px; }
        .plot-container { width: 600px; height: 400px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>HSP Values Analysis & Debug</h1>

    <div class="test-container">
        <h2>Data Analysis</h2>
        <div id="dataAnalysis" class="debug-info">Analyzing HSP data...</div>
    </div>

    <div class="test-container">
        <h2>Test: Perfect Sphere (Center at Origin)</h2>
        <div class="debug-info">Center: (0, 0, 0), Radius: 1 - Should be perfect</div>
        <div id="plotPerfect" class="plot-container"></div>
    </div>

    <div class="test-container">
        <h2>Test: HSP Scale Issue</h2>
        <div class="debug-info">Testing different scale relationships</div>
        <div id="plotScale" class="plot-container"></div>
    </div>

    <div class="test-container">
        <h2>Test: Equal Axis Ranges</h2>
        <div class="debug-info">Forcing equal axis ranges manually</div>
        <div id="plotEqual" class="plot-container"></div>
    </div>

    <script>
        // HSP data from your app
        const hspCenter = [15.6, 8.1, 13.0];
        const hspRadius = 6.5;
        const solvents = [
            { name: 'acetone', coords: [15.5, 10.4, 7.0] },
            { name: 'ethanol', coords: [15.8, 8.8, 19.4] },
            { name: 'hexane', coords: [14.9, 0, 0] },
            { name: 'toluene', coords: [18.0, 1.4, 2.0] }
        ];

        // Analyze the data
        function analyzeData() {
            const allX = [hspCenter[0], ...solvents.map(s => s.coords[0])];
            const allY = [hspCenter[1], ...solvents.map(s => s.coords[1])];
            const allZ = [hspCenter[2], ...solvents.map(s => s.coords[2])];

            const xRange = [Math.min(...allX) - hspRadius, Math.max(...allX) + hspRadius];
            const yRange = [Math.min(...allY) - hspRadius, Math.max(...allY) + hspRadius];
            const zRange = [Math.min(...allZ) - hspRadius, Math.max(...allZ) + hspRadius];

            const xSpan = xRange[1] - xRange[0];
            const ySpan = yRange[1] - yRange[0];
            const zSpan = zRange[1] - zRange[0];

            const analysis = `
<strong>HSP Data Analysis:</strong>
Center: (${hspCenter[0]}, ${hspCenter[1]}, ${hspCenter[2]})
Radius: ${hspRadius}

<strong>Coordinate Ranges:</strong>
X (δD): ${xRange[0].toFixed(1)} to ${xRange[1].toFixed(1)} (span: ${xSpan.toFixed(1)})
Y (δP): ${yRange[0].toFixed(1)} to ${yRange[1].toFixed(1)} (span: ${ySpan.toFixed(1)})
Z (δH): ${zRange[0].toFixed(1)} to ${zRange[1].toFixed(1)} (span: ${zSpan.toFixed(1)})

<strong>Span Ratios:</strong>
X:Y = ${(xSpan/ySpan).toFixed(2)}:1
X:Z = ${(xSpan/zSpan).toFixed(2)}:1
Y:Z = ${(ySpan/zSpan).toFixed(2)}:1

<strong>PROBLEM IDENTIFIED:</strong>
${ySpan < xSpan * 0.8 || zSpan < xSpan * 0.8 ?
  '⚠️ UNEQUAL SPANS! This causes sphere distortion.' :
  '✓ Spans are roughly equal'}

<strong>Solution:</strong>
Force equal axis ranges or normalize data to equal spans.
            `;

            document.getElementById('dataAnalysis').innerHTML = analysis;

            return { xRange, yRange, zRange, xSpan, ySpan, zSpan };
        }

        // Generate sphere
        function generateSphere(center, radius, resolution = 20) {
            const x = [];
            const y = [];
            const z = [];

            for (let i = 0; i < resolution; i++) {
                const xRow = [];
                const yRow = [];
                const zRow = [];
                for (let j = 0; j < resolution; j++) {
                    const u = 2 * Math.PI * j / (resolution - 1);
                    const v = Math.PI * i / (resolution - 1);

                    xRow.push(center[0] + radius * Math.cos(u) * Math.sin(v));
                    yRow.push(center[1] + radius * Math.sin(u) * Math.sin(v));
                    zRow.push(center[2] + radius * Math.cos(v));
                }
                x.push(xRow);
                y.push(yRow);
                z.push(zRow);
            }

            return { x, y, z };
        }

        // Test 1: Perfect sphere at origin
        function testPerfectSphere() {
            const sphere = generateSphere([0, 0, 0], 1);

            Plotly.newPlot('plotPerfect', [{
                type: 'surface',
                x: sphere.x,
                y: sphere.y,
                z: sphere.z,
                colorscale: 'Greens',
                opacity: 0.7,
                showscale: false
            }], {
                scene: {
                    aspectmode: 'cube',
                    camera: { eye: { x: 1.5, y: 1.5, z: 1.5 } }
                },
                title: 'Perfect Sphere Test (Should be round)'
            });
        }

        // Test 2: Scale issue demonstration
        function testScaleIssue() {
            const { xRange, yRange, zRange } = analyzeData();

            // Use actual HSP center but with equal spans
            const maxSpan = Math.max(xRange[1] - xRange[0], yRange[1] - yRange[0], zRange[1] - zRange[0]);
            const centerX = (xRange[0] + xRange[1]) / 2;
            const centerY = (yRange[0] + yRange[1]) / 2;
            const centerZ = (zRange[0] + zRange[1]) / 2;

            // Create sphere with normalized radius
            const normalizedRadius = hspRadius * 2 / maxSpan; // Make radius relative to span
            const sphere = generateSphere([0, 0, 0], normalizedRadius); // Center at origin

            Plotly.newPlot('plotScale', [{
                type: 'surface',
                x: sphere.x,
                y: sphere.y,
                z: sphere.z,
                colorscale: 'Greens',
                opacity: 0.7,
                showscale: false
            }], {
                scene: {
                    aspectmode: 'cube',
                    camera: { eye: { x: 1.5, y: 1.5, z: 1.5 } }
                },
                title: 'Normalized Scale Test'
            });
        }

        // Test 3: Force equal axis ranges
        function testEqualRanges() {
            const { xRange, yRange, zRange } = analyzeData();
            const maxSpan = Math.max(xRange[1] - xRange[0], yRange[1] - yRange[0], zRange[1] - zRange[0]);

            // Center each axis and use equal spans
            const equalRanges = {
                x: [hspCenter[0] - maxSpan/2, hspCenter[0] + maxSpan/2],
                y: [hspCenter[1] - maxSpan/2, hspCenter[1] + maxSpan/2],
                z: [hspCenter[2] - maxSpan/2, hspCenter[2] + maxSpan/2]
            };

            const sphere = generateSphere(hspCenter, hspRadius);

            Plotly.newPlot('plotEqual', [{
                type: 'surface',
                x: sphere.x,
                y: sphere.y,
                z: sphere.z,
                colorscale: 'Greens',
                opacity: 0.7,
                showscale: false
            }], {
                scene: {
                    aspectmode: 'manual',
                    aspectratio: { x: 1, y: 1, z: 1 },
                    xaxis: { range: equalRanges.x },
                    yaxis: { range: equalRanges.y },
                    zaxis: { range: equalRanges.z },
                    camera: { eye: { x: 1.5, y: 1.5, z: 1.5 } }
                },
                title: 'Forced Equal Axis Ranges'
            });
        }

        // Run all tests
        analyzeData();
        testPerfectSphere();
        testScaleIssue();
        testEqualRanges();
    </script>
</body>
</html>