<!DOCTYPE html>
<html>
<head>
    <title>Normalized Data Sphere Test</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-container { margin-bottom: 40px; border: 1px solid #ccc; padding: 20px; }
        .plot-container { width: 600px; height: 400px; margin: 10px 0; }
        h2 { color: #333; }
        .description { color: #666; margin-bottom: 10px; }
    </style>
</head>
<body>
    <h1>Normalized Data Sphere Test</h1>

    <div class="test-container">
        <h2>Test A: Original Scale Surface</h2>
        <div class="description">Original data (15, 8, 12, radius=5) with surface plot</div>
        <div id="plotA" class="plot-container"></div>
    </div>

    <div class="test-container">
        <h2>Test B: Normalized Scale Surface</h2>
        <div class="description">Normalized to [-1, 1] range with surface plot</div>
        <div id="plotB" class="plot-container"></div>
    </div>

    <div class="test-container">
        <h2>Test C: Normalized + Custom Axis Labels</h2>
        <div class="description">Normalized data with original scale axis labels</div>
        <div id="plotC" class="plot-container"></div>
    </div>

    <script>
        // Original data
        const originalCenter = [15, 8, 12];
        const originalRadius = 5;

        // Normalize data to [-1, 1] range
        function normalizeData(center, radius) {
            // Calculate global range
            const allValues = [
                ...center,
                center[0] - radius, center[0] + radius,
                center[1] - radius, center[1] + radius,
                center[2] - radius, center[2] + radius
            ];

            const globalMin = Math.min(...allValues);
            const globalMax = Math.max(...allValues);
            const globalRange = globalMax - globalMin;

            // Normalize function
            const normalize = (value) => 2 * (value - globalMin) / globalRange - 1;

            return {
                center: center.map(normalize),
                radius: 2 * radius / globalRange,
                originalMin: globalMin,
                originalMax: globalMax,
                range: globalRange
            };
        }

        const normalized = normalizeData(originalCenter, originalRadius);

        // Generate sphere surface
        function generateSphere(center, radius, resolution = 20) {
            const x = [];
            const y = [];
            const z = [];

            for (let i = 0; i < resolution; i++) {
                const xRow = [];
                const yRow = [];
                const zRow = [];
                for (let j = 0; j < resolution; j++) {
                    const u = 2 * Math.PI * j / (resolution - 1);
                    const v = Math.PI * i / (resolution - 1);

                    xRow.push(center[0] + radius * Math.cos(u) * Math.sin(v));
                    yRow.push(center[1] + radius * Math.sin(u) * Math.sin(v));
                    zRow.push(center[2] + radius * Math.cos(v));
                }
                x.push(xRow);
                y.push(yRow);
                z.push(zRow);
            }

            return { x, y, z };
        }

        // Test A: Original scale
        const originalSphere = generateSphere(originalCenter, originalRadius);
        Plotly.newPlot('plotA', [{
            type: 'surface',
            x: originalSphere.x,
            y: originalSphere.y,
            z: originalSphere.z,
            colorscale: 'Greens',
            opacity: 0.7,
            showscale: false
        }], {
            scene: {
                aspectmode: 'cube',
                camera: { eye: { x: 1.5, y: 1.5, z: 1.5 } }
            },
            title: 'Original Scale (Should be distorted)'
        });

        // Test B: Normalized scale
        const normalizedSphere = generateSphere(normalized.center, normalized.radius);
        Plotly.newPlot('plotB', [{
            type: 'surface',
            x: normalizedSphere.x,
            y: normalizedSphere.y,
            z: normalizedSphere.z,
            colorscale: 'Greens',
            opacity: 0.7,
            showscale: false
        }], {
            scene: {
                aspectmode: 'cube',
                camera: { eye: { x: 1.5, y: 1.5, z: 1.5 } }
            },
            title: 'Normalized Scale (Should be perfect sphere)'
        });

        // Test C: Normalized with custom axis labels
        const tickVals = [-1, -0.5, 0, 0.5, 1];
        const offset = normalized.originalMin + normalized.range / 2;
        const scaleFactor = normalized.range / 2;

        const tickText = tickVals.map(val =>
            (offset + val * scaleFactor).toFixed(1)
        );

        Plotly.newPlot('plotC', [{
            type: 'surface',
            x: normalizedSphere.x,
            y: normalizedSphere.y,
            z: normalizedSphere.z,
            colorscale: 'Greens',
            opacity: 0.7,
            showscale: false
        }], {
            scene: {
                aspectmode: 'cube',
                xaxis: {
                    title: 'δD [MPa^0.5]',
                    tickvals: tickVals,
                    ticktext: tickText
                },
                yaxis: {
                    title: 'δP [MPa^0.5]',
                    tickvals: tickVals,
                    ticktext: tickText
                },
                zaxis: {
                    title: 'δH [MPa^0.5]',
                    tickvals: tickVals,
                    ticktext: tickText
                },
                camera: { eye: { x: 1.5, y: 1.5, z: 1.5 } }
            },
            title: 'Normalized + Original Scale Labels'
        });

        // Log normalized values for debugging
        console.log('Original center:', originalCenter);
        console.log('Original radius:', originalRadius);
        console.log('Normalized center:', normalized.center);
        console.log('Normalized radius:', normalized.radius);
        console.log('Range info:', { min: normalized.originalMin, max: normalized.originalMax, range: normalized.range });
    </script>
</body>
</html>